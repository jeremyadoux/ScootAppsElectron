<html ng-app="app">
    <head>
        <meta charset="UTF-8">
        <title>ScoutApps !</title>
        <link rel="stylesheet" href="../css/bootstrap.min.css">
        <link rel="stylesheet" href="../css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="../bower_components/angular-ui-select/dist/select.css">

        <script src="../bower_components/angular/angular.js"></script>
        <script src="../bower_components/angular-sanitize/angular-sanitize.js"></script>
    </head>
    <body ng-controller="createTicketCtrl as ctc">
        <div ng-show="ctc.step == 1">
            <div class="row" ng-if="$index%3==0" ng-repeat="source in ctc.sources">
                <div class="col-md-4" ng-repeat="i in [0,1,2]">
                    <p ng-class="{'bg-primary': ctc.sources[$parent.$index+i].clicked}" style="padding: 10px;">
                        <img ng-src="{{ctc.sources[$parent.$index+i].urlTH}}" ng-click="ctc.clickedImage(ctc.sources[$parent.$index+i])" class="img-thumbnail" style="max-height: 250px;">
                    </p>
                </div>
            </div>
            <input type="button" ng-click="ctc.saveForm()" value="Continuer">
        </div>
        <div ng-show="ctc.step == 2">
            <div class="row">
                <div class="col-md-1">
                    <div class="row">
                        <div class="col-md-12">
                            <button class="btn btn-default" type="button" aria-label="Pointeur" ng-click="ctc.changeDrawingMode('pointer')">
                                <span class="glyphicon glyphicon-move" aria-hidden="true"></span>
                            </button>
                        </div>
                        <div class="col-md-12">
                            <button class="btn btn-default" type="button" aria-label="Crayon" ng-click="ctc.changeDrawingMode('pencil')">
                                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                            </button>
                        </div>
                        <div class="col-md-12">
                            <button class="btn btn-default" type="button" aria-label="Carré" ng-click="ctc.changeDrawingMode('square')">
                                <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
                            </button>
                        </div>
                        <div class="col-md-12">
                            <button class="btn btn-default" type="button" aria-label="Go to ticket" ng-click="ctc.goToCreateTicket()">
                                <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-11">
                    <canvas id="canvas">
                        Your browser does not support the canvas element.
                    </canvas>
                    <input type="button" ng-click="ctc.previousScreen()" value="<<">
                    <input type="button" ng-click="ctc.nextScreen()" value=">>">
                </div>
            </div>
        </div>
        <div ng-show="ctc.step == 3">
            <form class="form-horizontal">
                <div class="form-group">
                    <label for="inputProject" class="col-sm-2 control-label">Projet</label>
                    <div class="col-sm-10">
                        <ui-select id="inputProject" ng-model="ctc.createTicket.project">
                            <ui-select-match>
                                <span ng-bind="ctc.createTicket.project.name"></span>
                            </ui-select-match>
                            <ui-select-choices repeat="item in (ctc.dataSelect.projects | filter: $select.search) track by item.id">
                                <span ng-bind="item.name"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputTracker" class="col-sm-2 control-label">Tracker</label>
                    <div class="col-sm-10">
                        <ui-select id="inputTracker" ng-model="ctc.createTicket.tracker">
                            <ui-select-match>
                                <span ng-bind="ctc.createTicket.tracker.name"></span>
                            </ui-select-match>
                            <ui-select-choices repeat="item in (ctc.dataSelect.tracker | filter: $select.search) track by item.id">
                                <span ng-bind="item.name"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputSubject" class="col-sm-2 control-label">Sujet</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" ng-model="ctc.createTicket.title" id="inputSubject" placeholder="Sujet">
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputDescription" class="col-sm-2 control-label">Description</label>
                    <div class="col-sm-10">
                        <textarea id="inputDescription" ng-model="ctc.createTicket.description" class="form-control" rows="3"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputStatus" class="col-sm-2 control-label">Statut</label>
                    <div class="col-sm-10">
                        <ui-select id="inputStatus" ng-model="ctc.createTicket.status">
                            <ui-select-match>
                                <span ng-bind="ctc.createTicket.status.name"></span>
                            </ui-select-match>
                            <ui-select-choices repeat="item in (ctc.dataSelect.status | filter: $select.search) track by item.id">
                                <span ng-bind="item.name"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputPriority" class="col-sm-2 control-label">Priorité</label>
                    <div class="col-sm-10">
                        <ui-select id="inputPriority" ng-model="ctc.createTicket.priority">
                            <ui-select-match>
                                <span ng-bind="ctc.createTicket.priority.name"></span>
                            </ui-select-match>
                            <ui-select-choices repeat="item in (ctc.dataSelect.priorities | filter: $select.search) track by item.id">
                                <span ng-bind="item.name"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputVersion" class="col-sm-2 control-label">Version cible</label>
                    <div class="col-sm-10">
                        <ui-select id="inputVersion" ng-model="ctc.createTicket.version">
                            <ui-select-match>
                                <span ng-bind="ctc.createTicket.version.name"></span>
                            </ui-select-match>
                            <ui-select-choices repeat="item in (ctc.dataSelect.version | filter: $select.search) track by item.id">
                                <span ng-bind="item.name"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
                <button type="button" class="btn btn-success" ng-click="ctc.loadParentUS()">Charger les US parents disponibles</button>
                    <div class="form-group">
                        <label for="inputParent" class="col-sm-2 control-label" >Tâches parentes</label>
                        <div class="col-sm-10">
                           <ui-select id="inputParent" ng-model="ctc.createTicket.parent_issue_id">
                               <ui-select-match>
                                   <span ng-bind="ctc.createTicket.parent_issue_id.subject"></span>
                               </ui-select-match>
                               <ui-select-choices repeat="item in (ctc.dataSelect.parentIssue | filter: $select.search) track by item.id">
                                   <span ng-bind="item.subject"></span>
                               </ui-select-choices>
                           </ui-select>
                        </div>
                   </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" ng-model="ctc.createTicket.reopen"> Réouvrir la US parente
                                </label>
                            </div>
                        </div>
                    </div>

                <button type="button" class="btn btn-success" ng-click="ctc.saveTicketFull()">Enregistrer</button>
            </form>
        </div>
        <script src="../bower_components/fabric/dist/fabric.js"></script>
        <script src="../bower_components/angular-ui-select/dist/select.js"></script>
        <script src="../js/create-ticket.js"></script>
        <script src="../js/services/redmine.service.js"></script>
    </body>
</html>
